-- Criação da tabela UNIDADE
CREATE TABLE UNIDADE (
    ID SERIAL PRIMARY KEY,
    EMPREENDIMENTO VARCHAR(256),
    CEP VARCHAR(8),
    UNIDADE VARCHAR(64),
    BLOCO VARCHAR(32),
    APTO VARCHAR(32)
);

-- Criação da tabela FUNCAO
CREATE TABLE FUNCAO (
    ID SERIAL PRIMARY KEY,
    FUNCAO_NOME VARCHAR(256) NOT NULL
);

-- Criação da tabela PERMISSAO
CREATE TABLE PERMISSAO (
    ID SERIAL PRIMARY KEY,
    PERMISSAO_NOME VARCHAR(3) NOT NULL
);

-- Criação da tabela ESCALA
CREATE TABLE ESCALA (
    ID SERIAL PRIMARY KEY,
    ESCALA_NOME VARCHAR(256) NOT NULL,
    ENTRADA TIME NOT NULL,
    PAUSA TIME,
    RETORNO TIME,
    SAIDA TIME NOT NULL
);

-- Criação da tabela CADASTRO
CREATE TABLE CADASTRO (
    ID SERIAL PRIMARY KEY,
    NOME VARCHAR(128) NOT NULL,
    CPF VARCHAR(11) NOT NULL UNIQUE,
    PASSWORD_HASH VARCHAR(60) NOT NULL,
    FUNCAO_ID INT REFERENCES FUNCAO(ID) NOT NULL,
    ESCALA_ID INT REFERENCES ESCALA(ID) NOT NULL,
    PERMISSAO_ID INT REFERENCES PERMISSAO(ID) NOT NULL
);

-- Criação da tabela SERVICO
CREATE TABLE SERVICO (
    ID SERIAL PRIMARY KEY,
    DESCRICAO VARCHAR(512) NOT NULL,
    UNIDADE_ID INT REFERENCES UNIDADE(ID),
    PROFISSIONAL_QTD INT NOT NULL,
    SERVENTE_QTD INT NOT NULL,
    PROFISSIONAL_MINUTOS INT NOT NULL,
    SERVENTE_MINUTOS INT NOT NULL
);

-- fiz ate aq no python

-- Tabela associativa para RESTRICAO entre SERVICOS
CREATE TABLE SERVICO_RESTRICAO (
    ID SERIAL PRIMARY KEY,
    SERVICO_ID INT REFERENCES SERVICO(ID) ON DELETE CASCADE,
    RESTRICAO_ID INT REFERENCES SERVICO(ID) ON DELETE CASCADE
);

-- Criação da tabela TAREFA
CREATE TABLE TAREFA (
    ID SERIAL PRIMARY KEY,
    DATA_INICIO DATE NOT NULL,
    DATA_FIM DATE NOT NULL,
    SERVICO_ID INT REFERENCES SERVICO(ID),
    ATIVO BOOL DEFAULT FALSE,
    RESPONSAVEL_ID INT REFERENCES CADASTRO(ID) NOT NULL
);

-- Tabela associativa para FUNCIONARIOS em TAREFAS
CREATE TABLE TAREFA_FUNCIONARIO (
    ID SERIAL PRIMARY KEY,
    TAREFA_ID INT REFERENCES TAREFA(ID) ON DELETE CASCADE,
    FUNCIONARIO_ID INT REFERENCES CADASTRO(ID) ON DELETE CASCADE
);

-- Tabela associativa para CHUVA relacionada a SERVICOS em TAREFAS
CREATE TABLE TAREFA_CHUVA (
    ID SERIAL PRIMARY KEY,
    TAREFA_ID INT REFERENCES TAREFA(ID) ON DELETE CASCADE,
    CHUVA_SERVICO_ID INT REFERENCES SERVICO(ID) ON DELETE CASCADE
);
